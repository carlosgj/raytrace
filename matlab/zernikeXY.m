function [z, dxdy] = zernikeXY(c, xy, R)
% Zernike perturbations, using Noll indexing
% c  = [N] coefficients, starting at piston
% xy = [M x 2] x and y coordinates
% R  = radius to normalize x and y to.
% z = surface elevation
% dxdy [M x 2] = [dx/R, dy/R] surface normal at points (x,y,z) is [dx/R, dy/R, 1]
% fortunately, Richard J. Mathar of Leiden Observatory has calculated the
% cartesian coordinates for the first 55 modes for us!
% Serb. Astr. J. 179 (2009) 107-120. https://arxiv.org/abs/0809.2368
x = xy(:,1)/R;
y = xy(:,2)/R;
z = 0;
dx = 0;
dy = 0;

% make it go faster by caching multiplications, x2.*y => x2y
% a C compiler might do that automatically

N = numel(c);
if N > 55, error('I can only handle zernike modes up to 9th order (55 of them)');end

if (1<=N)
z = z + c(1).*(1);
end
if (2<=N)
z = z + c(2).*(x);
dx=dx+c(2).*(1);
% dy=dy+c(2).*(0);
end
if (3<=N)
z = z + c(3).*(y);
% dx=dx+c(3).*(0);
dy=dy+c(3).*(1);
end
if (4<=N)
    x2 = x.*x;
    y2 = y.*y;
z = z + c(4).*(2.*x2 + 2.*y2 - 1);
dx=dx+c(4).*(4.*x);
dy=dy+c(4).*(4.*y);
end
if (5<=N)
    xy = x.*y;
z = z + c(5).*(2.*xy);
dx=dx+c(5).*(2.*y);
dy=dy+c(5).*(2.*x);
end
if (6<=N)
z = z + c(6).*(x2 - y2);
dx=dx+c(6).*(2.*x);
dy=dy+c(6).*(-2.*y);
end
if (7<=N)
    x3 = x2.*x;
    y3 = y2.*y;
z = z + c(7).*(3.*x2.*y - 2.*y + 3.*y3);
dx=dx+c(7).*(6.*x.*y);
dy=dy+c(7).*(3.*x2 + 9.*y2 - 2);
end
if (8<=N)
z = z + c(8).*(3.*x.*y2 - 2.*x + 3.*x3);
dx=dx+c(8).*(9.*x2 + 3.*y2 - 2);
dy=dy+c(8).*(6.*x.*y);
end
if (9<=N)
z = z + c(9).*(3.*x2.*y - y3);
dx=dx+c(9).*(6.*xy);
dy=dy+c(9).*(3.*x2 - 3.*y2);
end
if (10<=N)
z = z + c(10).*(x3 - 3.*x.*y2);
dx=dx+c(10).*(3.*x2 - 3.*y2);
dy=dy+c(10).*(-6.*x.*y);
end
if (11<=N)
    x4 = x3.*x;
    y4 = y3.*y;
z = z + c(11).*(12.*x2.*y2 - 6.*x2 + 6.*x4 - 6.*y2 + 6.*y4 + 1);
dx=dx+c(11).*(24.*x.*y2 - 12.*x + 24.*x3);
dy=dy+c(11).*(24.*x2.*y - 12.*y + 24.*y3);
end
if (12<=N)
z = z + c(12).*(4.*x4 - 3.*x2 + 3.*y2 - 4.*y4);
dx=dx+c(12).*(16.*x3 - 6.*x);
dy=dy+c(12).*(6.*y - 16.*y3);
end
if (13<=N)
z = z + c(13).*(8.*x.*y3 - 6.*x.*y + 8.*x3.*y);
dx=dx+c(13).*(24.*x2.*y - 6.*y + 8.*y3);
dy=dy+c(13).*(24.*x.*y2 - 6.*x + 8.*x3);
end
if (14<=N)
z = z + c(14).*(x4 - 6.*x2.*y2 + y4);
dx=dx+c(14).*(4.*x3 - 12.*x.*y2);
dy=dy+c(14).*(4.*y3 - 12.*x2.*y);
end
if (15<=N)
z = z + c(15).*(4.*x3.*y - 4.*x.*y3);
dx=dx+c(15).*(12.*x2.*y - 4.*y3);
dy=dy+c(15).*(4.*x3 - 12.*x.*y2);
end
if (16<=N)  
    x5 = x4.*x;
    y5 = y4.*y;
z = z + c(16).*(3.*x + 20.*x3.*y2 - 12.*x.*y2 + 10.*x.*y4 - 12.*x3 + 10.*x5);
dx=dx+c(16).*(60.*x2.*y2 - 36.*x2 + 50.*x4 - 12.*y2 + 10.*y4 + 3);
dy=dy+c(16).*(40.*x.*y3 - 24.*x.*y + 40.*x3.*y);
end
if (17<=N)
z = z + c(17).*(3.*y + 20.*x2.*y3 - 12.*x2.*y + 10.*x4.*y - 12.*y3 + 10.*y5);
dx=dx+c(17).*(40.*x.*y3 - 24.*x.*y + 40.*x3.*y);
dy=dy+c(17).*(60.*x2.*y2 - 12.*x2 + 10.*x4 - 36.*y2 + 50.*y4 + 3);
end
if (18<=N)
z = z + c(18).*(12.*x.*y2 - 10.*x3.*y2 - 15.*x.*y4 - 4.*x3 + 5.*x5);
dx=dx+c(18).*(25.*x4 - 12.*x2 - 30.*x2.*y2 + 12.*y2 - 15.*y4);
dy=dy+c(18).*(24.*x.*y - 60.*x.*y3 - 20.*x3.*y);
end
if (19<=N)
z = z + c(19).*(10.*x2.*y3 - 12.*x2.*y + 15.*x4.*y + 4.*y3 - 5.*y5);
dx=dx+c(19).*(20.*x.*y3 - 24.*x.*y + 60.*x3.*y);
dy=dy+c(19).*(30.*x2.*y2 - 12.*x2 + 15.*x4 + 12.*y2 - 25.*y4);
end
if (20<=N)
z = z + c(20).*(5.*x.*y4 - 10.*x3.*y2 + x5);
dx=dx+c(20).*(5.*x4 - 30.*x2.*y2 + 5.*y4);
dy=dy+c(20).*(20.*x.*y3 - 20.*x3.*y);
end
if (21<=N)
z = z + c(21).*(5.*x4.*y - 10.*x2.*y3 + y5);
dx=dx+c(21).*(20.*x3.*y - 20.*x.*y3);
dy=dy+c(21).*(5.*x4 - 30.*x2.*y2 + 5.*y4);
end
if (22<=N)
    x6 = x5.*x;
    y6 = y5.*y;
z = z + c(22).*(60.*x2.*y4 - 60.*x2.*y2 + 60.*x4.*y2 + 12.*x2 - 30.*x4 + 20.*x6 + 12.*y2 - 30.*y4 + 20.*y6 - 1);
dx=dx+c(22).*(24.*x + 240.*x3.*y2 - 120.*x.*y2 + 120.*x.*y4 - 120.*x3 + 120.*x5);
dy=dy+c(22).*(24.*y + 240.*x2.*y3 - 120.*x2.*y + 120.*x4.*y - 120.*y3 + 120.*y5);
end
if (23<=N)
z = z + c(23).*(60.*x3.*y3 + 12.*x.*y - 40.*x.*y3 - 40.*x3.*y + 30.*x.*y5 + 30.*x5.*y);
dx=dx+c(23).*(12.*y + 180.*x2.*y3 - 120.*x2.*y + 150.*x4.*y - 40.*y3 + 30.*y5);
dy=dy+c(23).*(12.*x + 180.*x3.*y2 - 120.*x.*y2 + 150.*x.*y4 - 40.*x3 + 30.*x5);
end
if (24<=N)
z = z + c(24).*(15.*x4.*y2 - 15.*x2.*y4 + 6.*x2 - 20.*x4 + 15.*x6 - 6.*y2 + 20.*y4 - 15.*y6);
dx=dx+c(24).*(12.*x + 60.*x3.*y2 - 30.*x.*y4 - 80.*x3 + 90.*x5);
dy=dy+c(24).*(30.*x4.*y - 60.*x2.*y3 - 12.*y + 80.*y3 - 90.*y5);
end
if (25<=N)
z = z + c(25).*(20.*x.*y3 - 20.*x3.*y - 24.*x.*y5 + 24.*x5.*y);
dx=dx+c(25).*(120.*x4.*y - 60.*x2.*y + 20.*y3 - 24.*y5);
dy=dy+c(25).*(60.*x.*y2 - 120.*x.*y4 - 20.*x3 + 24.*x5);
end
if (26<=N)
z = z + c(26).*(30.*x2.*y2 - 30.*x2.*y4 - 30.*x4.*y2 - 5.*x4 + 6.*x6 - 5.*y4 + 6.*y6);
dx=dx+c(26).*(60.*x.*y2 - 120.*x3.*y2 - 60.*x.*y4 - 20.*x3 + 36.*x5);
dy=dy+c(26).*(60.*x2.*y - 120.*x2.*y3 - 60.*x4.*y - 20.*y3 + 36.*y5);
end
if (27<=N)
z = z + c(27).*(6.*x.*y5 - 20.*x3.*y3 + 6.*x5.*y);
dx=dx+c(27).*(30.*x4.*y - 60.*x2.*y3 + 6.*y5);
dy=dy+c(27).*(30.*x.*y4 - 60.*x3.*y2 + 6.*x5);
end
if (28<=N)
z = z + c(28).*(15.*x2.*y4 - 15.*x4.*y2 + x6 - y6);
dx=dx+c(28).*(30.*x.*y4 - 60.*x3.*y2 + 6.*x5);
dy=dy+c(28).*(60.*x2.*y3 - 30.*x4.*y - 6.*y5);
end
if (29<=N)
    x7 = x6.*x;
    y7 = y6.*y;
z = z + c(29).*(105.*x2.*y5 - 120.*x2.*y3 - 4.*y + 105.*x4.*y3 + 30.*x2.*y - 60.*x4.*y + 35.*x6.*y + 30.*y3 - 60.*y5 + 35.*y7);
dx=dx+c(29).*(420.*x3.*y3 + 60.*x.*y - 240.*x.*y3 - 240.*x3.*y + 210.*x.*y5 + 210.*x5.*y);
dy=dy+c(29).*(525.*x2.*y4 - 360.*x2.*y2 + 315.*x4.*y2 + 30.*x2 - 60.*x4 + 35.*x6 + 90.*y2 - 300.*y4 + 245.*y6 - 4);
end
if (30<=N)
z = z + c(30).*(105.*x3.*y4 - 120.*x3.*y2 - 4.*x + 105.*x5.*y2 + 30.*x.*y2 - 60.*x.*y4 + 35.*x.*y6 + 30.*x3 - 60.*x5 + 35.*x7);
dx=dx+c(30).*(315.*x2.*y4 - 360.*x2.*y2 + 525.*x4.*y2 + 90.*x2 - 300.*x4 + 245.*x6 + 30.*y2 - 60.*y4 + 35.*y6 - 4);
dy=dy+c(30).*(420.*x3.*y3 + 60.*x.*y - 240.*x.*y3 - 240.*x3.*y + 210.*x.*y5 + 210.*x5.*y);
end
if (31<=N)
z = z + c(31).*(21.*x2.*y5 - 60.*x2.*y3 + 105.*x4.*y3 + 30.*x2.*y - 90.*x4.*y + 63.*x6.*y - 10.*y3 + 30.*y5 - 21.*y7);
dx=dx+c(31).*(420.*x3.*y3 + 60.*x.*y - 120.*x.*y3 - 360.*x3.*y + 42.*x.*y5 + 378.*x5.*y);
dy=dy+c(31).*(105.*x2.*y4 - 180.*x2.*y2 + 315.*x4.*y2 + 30.*x2 - 90.*x4 + 63.*x6 - 30.*y2 + 150.*y4 - 147.*y6);
end
if (32<=N)
z = z + c(32).*(60.*x3.*y2 - 105.*x3.*y4 - 21.*x5.*y2 - 30.*x.*y2 + 90.*x.*y4 - 63.*x.*y6 + 10.*x3 - 30.*x5 + 21.*x7);
dx=dx+c(32).*(180.*x2.*y2 - 315.*x2.*y4 - 105.*x4.*y2 + 30.*x2 - 150.*x4 + 147.*x6 - 30.*y2 + 90.*y4 - 63.*y6);
dy=dy+c(32).*(360.*x.*y3 - 60.*x.*y - 420.*x3.*y3 + 120.*x3.*y - 378.*x.*y5 - 42.*x5.*y);
end
if (33<=N)
z = z + c(33).*(60.*x2.*y3 - 63.*x2.*y5 - 35.*x4.*y3 - 30.*x4.*y + 35.*x6.*y - 6.*y5 + 7.*y7);
dx=dx+c(33).*(120.*x.*y3 - 140.*x3.*y3 - 120.*x3.*y - 126.*x.*y5 + 210.*x5.*y);
dy=dy+c(33).*(180.*x2.*y2 - 315.*x2.*y4 - 105.*x4.*y2 - 30.*x4 + 35.*x6 - 30.*y4 + 49.*y6);
end
if (34<=N)
z = z + c(34).*(60.*x3.*y2 - 35.*x3.*y4 - 63.*x5.*y2 - 30.*x.*y4 + 35.*x.*y6 - 6.*x5 + 7.*x7);
dx=dx+c(34).*(180.*x2.*y2 - 105.*x2.*y4 - 315.*x4.*y2 - 30.*x4 + 49.*x6 - 30.*y4 + 35.*y6);
dy=dy+c(34).*(120.*x3.*y - 120.*x.*y3 - 140.*x3.*y3 + 210.*x.*y5 - 126.*x5.*y);
end
if (35<=N)
z = z + c(35).*(21.*x2.*y5 - 35.*x4.*y3 + 7.*x6.*y - y7);
dx=dx+c(35).*(42.*x.*y5 - 140.*x3.*y3 + 42.*x5.*y);
dy=dy+c(35).*(105.*x2.*y4 - 105.*x4.*y2 + 7.*x6 - 7.*y6);
end
if (36<=N)
z = z + c(36).*(35.*x3.*y4 - 21.*x5.*y2 - 7.*x.*y6 + x7);
dx=dx+c(36).*(105.*x2.*y4 - 105.*x4.*y2 + 7.*x6 - 7.*y6);
dy=dy+c(36).*(140.*x3.*y3 - 42.*x.*y5 - 42.*x5.*y);
end
if (37<=N)
    x8 = x7.*x;
    y8 = y7.*y;
z = z + c(37).*(180.*x2.*y2 - 420.*x2.*y4 - 420.*x4.*y2 + 280.*x2.*y6 + 420.*x4.*y4 + 280.*x6.*y2 - 20.*x2 + 90.*x4 - 140.*x6 + 70.*x8 - 20.*y2 + 90.*y4 - 140.*y6 + 70.*y8 + 1);
dx=dx+c(37).*(1680.*x3.*y4 - 1680.*x3.*y2 - 40.*x + 1680.*x5.*y2 + 360.*x.*y2 - 840.*x.*y4 + 560.*x.*y6 + 360.*x3 - 840.*x5 + 560.*x7);
dy=dy+c(37).*(1680.*x2.*y5 - 1680.*x2.*y3 - 40.*y + 1680.*x4.*y3 + 360.*x2.*y - 840.*x4.*y + 560.*x6.*y + 360.*y3 - 840.*y5 + 560.*y7);
end
if (38<=N)
z = z + c(38).*(105.*x2.*y4 - 105.*x4.*y2 - 112.*x2.*y6 + 112.*x6.*y2 - 10.*x2 + 60.*x4 - 105.*x6 + 56.*x8 + 10.*y2 - 60.*y4 + 105.*y6 - 56.*y8);
dx=dx+c(38).*(672.*x5.*y2 - 420.*x3.*y2 - 20.*x + 210.*x.*y4 - 224.*x.*y6 + 240.*x3 - 630.*x5 + 448.*x7);
dy=dy+c(38).*(20.*y + 420.*x2.*y3 - 672.*x2.*y5 - 210.*x4.*y + 224.*x6.*y - 240.*y3 + 630.*y5 - 448.*y7);
end
if (39<=N)
z = z + c(39).*(336.*x3.*y5 - 420.*x3.*y3 + 336.*x5.*y3 - 20.*x.*y + 120.*x.*y3 + 120.*x3.*y - 210.*x.*y5 - 210.*x5.*y + 112.*x.*y7 + 112.*x7.*y);
dx=dx+c(39).*(1008.*x2.*y5 - 1260.*x2.*y3 - 20.*y + 1680.*x4.*y3 + 360.*x2.*y - 1050.*x4.*y + 784.*x6.*y + 120.*y3 - 210.*y5 + 112.*y7);
dy=dy+c(39).*(1680.*x3.*y4 - 1260.*x3.*y2 - 20.*x + 1008.*x5.*y2 + 360.*x.*y2 - 1050.*x.*y4 + 784.*x.*y6 + 120.*x3 - 210.*x5 + 112.*x7);
end
if (40<=N)
z = z + c(40).*(210.*x2.*y4 - 90.*x2.*y2 + 210.*x4.*y2 - 112.*x2.*y6 - 280.*x4.*y4 - 112.*x6.*y2 + 15.*x4 - 42.*x6 + 28.*x8 + 15.*y4 - 42.*y6 + 28.*y8);
dx=dx+c(40).*(840.*x3.*y2 - 1120.*x3.*y4 - 672.*x5.*y2 - 180.*x.*y2 + 420.*x.*y4 - 224.*x.*y6 + 60.*x3 - 252.*x5 + 224.*x7);
dy=dy+c(40).*(840.*x2.*y3 - 672.*x2.*y5 - 1120.*x4.*y3 - 180.*x2.*y + 420.*x4.*y - 224.*x6.*y + 60.*y3 - 252.*y5 + 224.*y7);
end
if (41<=N)
z = z + c(41).*(112.*x5.*y3 - 112.*x3.*y5 - 60.*x.*y3 + 60.*x3.*y + 168.*x.*y5 - 168.*x5.*y - 112.*x.*y7 + 112.*x7.*y);
dx=dx+c(41).*(560.*x4.*y3 - 336.*x2.*y5 + 180.*x2.*y - 840.*x4.*y + 784.*x6.*y - 60.*y3 + 168.*y5 - 112.*y7);
dy=dy+c(41).*(336.*x5.*y2 - 560.*x3.*y4 - 180.*x.*y2 + 840.*x.*y4 - 784.*x.*y6 + 60.*x3 - 168.*x5 + 112.*x7);
end
if (42<=N)
z = z + c(42).*(105.*x4.*y2 - 105.*x2.*y4 + 112.*x2.*y6 - 112.*x6.*y2 - 7.*x6 + 8.*x8 + 7.*y6 - 8.*y8);
dx=dx+c(42).*(420.*x3.*y2 - 672.*x5.*y2 - 210.*x.*y4 + 224.*x.*y6 - 42.*x5 + 64.*x7);
dy=dy+c(42).*(672.*x2.*y5 - 420.*x2.*y3 + 210.*x4.*y - 224.*x6.*y + 42.*y5 - 64.*y7);
end
if (43<=N)
z = z + c(43).*(140.*x3.*y3 - 112.*x3.*y5 - 112.*x5.*y3 - 42.*x.*y5 - 42.*x5.*y + 48.*x.*y7 + 48.*x7.*y);
dx=dx+c(43).*(420.*x2.*y3 - 336.*x2.*y5 - 560.*x4.*y3 - 210.*x4.*y + 336.*x6.*y - 42.*y5 + 48.*y7);
dy=dy+c(43).*(420.*x3.*y2 - 560.*x3.*y4 - 336.*x5.*y2 - 210.*x.*y4 + 336.*x.*y6 - 42.*x5 + 48.*x7);
end
if (44<=N)
z = z + c(44).*(70.*x4.*y4 - 28.*x2.*y6 - 28.*x6.*y2 + x8 + y8);
dx=dx+c(44).*(280.*x3.*y4 - 168.*x5.*y2 - 56.*x.*y6 + 8.*x7);
dy=dy+c(44).*(280.*x4.*y3 - 168.*x2.*y5 - 56.*x6.*y + 8.*y7);
end
if (45<=N)
z = z + c(45).*(56.*x3.*y5 - 56.*x5.*y3 - 8.*x.*y7 + 8.*x7.*y);
dx=dx+c(45).*(168.*x2.*y5 - 280.*x4.*y3 + 56.*x6.*y - 8.*y7);
dy=dy+c(45).*(280.*x3.*y4 - 168.*x5.*y2 - 56.*x.*y6 + 8.*x7);
end
if (46<=N)
    x9 = x8.*x;
    y9 = y8.*y;
z = z + c(46).*(5.*x + 420.*x3.*y2 - 840.*x3.*y4 - 840.*x5.*y2 + 504.*x3.*y6 + 756.*x5.*y4 + 504.*x7.*y2 - 60.*x.*y2 + 210.*x.*y4 - 280.*x.*y6 + 126.*x.*y8 - 60.*x3 + 210.*x5 - 280.*x7 + 126.*x9);
dx=dx+c(46).*(1260.*x2.*y2 - 2520.*x2.*y4 - 4200.*x4.*y2 + 1512.*x2.*y6 + 3780.*x4.*y4 + 3528.*x6.*y2 - 180.*x2 + 1050.*x4 - 1960.*x6 + 1134.*x8 - 60.*y2 + 210.*y4 - 280.*y6 + 126.*y8 + 5);
dy=dy+c(46).*(3024.*x3.*y5 - 3360.*x3.*y3 + 3024.*x5.*y3 - 120.*x.*y + 840.*x.*y3 + 840.*x3.*y - 1680.*x.*y5 - 1680.*x5.*y + 1008.*x.*y7 + 1008.*x7.*y);
end
if (47<=N)
z = z + c(47).*(5.*y + 420.*x2.*y3 - 840.*x2.*y5 - 840.*x4.*y3 + 504.*x2.*y7 + 756.*x4.*y5 + 504.*x6.*y3 - 60.*x2.*y + 210.*x4.*y - 280.*x6.*y + 126.*x8.*y - 60.*y3 + 210.*y5 - 280.*y7 + 126.*y9);
dx=dx+c(47).*(3024.*x3.*y5 - 3360.*x3.*y3 + 3024.*x5.*y3 - 120.*x.*y + 840.*x.*y3 + 840.*x3.*y - 1680.*x.*y5 - 1680.*x5.*y + 1008.*x.*y7 + 1008.*x7.*y);
dy=dy+c(47).*(1260.*x2.*y2 - 4200.*x2.*y4 - 2520.*x4.*y2 + 3528.*x2.*y6 + 3780.*x4.*y4 + 1512.*x6.*y2 - 60.*x2 + 210.*x4 - 280.*x6 + 126.*x8 - 180.*y2 + 1050.*y4 - 1960.*y6 + 1134.*y8 + 5);
end
if (48<=N)
z = z + c(48).*(840.*x3.*y4 - 210.*x3.*y2 + 168.*x5.*y2 - 672.*x3.*y6 - 504.*x5.*y4 + 60.*x.*y2 - 315.*x.*y4 + 504.*x.*y6 - 252.*x.*y8 - 20.*x3 + 105.*x5 - 168.*x7 + 84.*x9);
dx=dx+c(48).*(2520.*x2.*y4 - 630.*x2.*y2 + 840.*x4.*y2 - 2016.*x2.*y6 - 2520.*x4.*y4 - 60.*x2 + 525.*x4 - 1176.*x6 + 756.*x8 + 60.*y2 - 315.*y4 + 504.*y6 - 252.*y8);
dy=dy+c(48).*(3360.*x3.*y3 - 4032.*x3.*y5 - 2016.*x5.*y3 + 120.*x.*y - 1260.*x.*y3 - 420.*x3.*y + 3024.*x.*y5 + 336.*x5.*y - 2016.*x.*y7);
end
if (49<=N)
z = z + c(49).*(210.*x2.*y3 - 168.*x2.*y5 - 840.*x4.*y3 + 504.*x4.*y5 + 672.*x6.*y3 - 60.*x2.*y + 315.*x4.*y - 504.*x6.*y + 252.*x8.*y + 20.*y3 - 105.*y5 + 168.*y7 - 84.*y9);
dx=dx+c(49).*(2016.*x3.*y5 - 3360.*x3.*y3 + 4032.*x5.*y3 - 120.*x.*y + 420.*x.*y3 + 1260.*x3.*y - 336.*x.*y5 - 3024.*x5.*y + 2016.*x7.*y);
dy=dy+c(49).*(630.*x2.*y2 - 840.*x2.*y4 - 2520.*x4.*y2 + 2520.*x4.*y4 + 2016.*x6.*y2 - 60.*x2 + 315.*x4 - 504.*x6 + 252.*x8 + 60.*y2 - 525.*y4 + 1176.*y6 - 756.*y8);
end
if (50<=N)
z = z + c(50).*(280.*x3.*y4 - 210.*x3.*y2 + 504.*x5.*y2 - 504.*x5.*y4 - 288.*x7.*y2 + 105.*x.*y4 - 280.*x.*y6 + 180.*x.*y8 + 21.*x5 - 56.*x7 + 36.*x9);
dx=dx+c(50).*(840.*x2.*y4 - 630.*x2.*y2 + 2520.*x4.*y2 - 2520.*x4.*y4 - 2016.*x6.*y2 + 105.*x4 - 392.*x6 + 324.*x8 + 105.*y4 - 280.*y6 + 180.*y8);
dy=dy+c(50).*(1120.*x3.*y3 - 2016.*x5.*y3 + 420.*x.*y3 - 420.*x3.*y - 1680.*x.*y5 + 1008.*x5.*y + 1440.*x.*y7 - 576.*x7.*y);
end
if (51<=N)
z = z + c(51).*(504.*x2.*y5 - 210.*x2.*y3 + 280.*x4.*y3 - 288.*x2.*y7 - 504.*x4.*y5 + 105.*x4.*y - 280.*x6.*y + 180.*x8.*y + 21.*y5 - 56.*y7 + 36.*y9);
dx=dx+c(51).*(1120.*x3.*y3 - 2016.*x3.*y5 - 420.*x.*y3 + 420.*x3.*y + 1008.*x.*y5 - 1680.*x5.*y - 576.*x.*y7 + 1440.*x7.*y);
dy=dy+c(51).*(2520.*x2.*y4 - 630.*x2.*y2 + 840.*x4.*y2 - 2016.*x2.*y6 - 2520.*x4.*y4 + 105.*x4 - 280.*x6 + 180.*x8 + 105.*y4 - 392.*y6 + 324.*y8);
end
if (52<=N)
z = z + c(52).*(168.*x5.*y2 - 280.*x3.*y4 + 252.*x3.*y6 + 126.*x5.*y4 - 180.*x7.*y2 + 56.*x.*y6 - 63.*x.*y8 - 8.*x7 + 9.*x9);
dx=dx+c(52).*(840.*x4.*y2 - 840.*x2.*y4 + 756.*x2.*y6 + 630.*x4.*y4 - 1260.*x6.*y2 - 56.*x6 + 81.*x8 + 56.*y6 - 63.*y8);
dy=dy+c(52).*(1512.*x3.*y5 - 1120.*x3.*y3 + 504.*x5.*y3 + 336.*x.*y5 + 336.*x5.*y - 504.*x.*y7 - 360.*x7.*y);
end
if (53<=N)
z = z + c(53).*(280.*x4.*y3 - 168.*x2.*y5 + 180.*x2.*y7 - 126.*x4.*y5 - 252.*x6.*y3 - 56.*x6.*y + 63.*x8.*y + 8.*y7 - 9.*y9);
dx=dx+c(53).*(1120.*x3.*y3 - 504.*x3.*y5 - 1512.*x5.*y3 - 336.*x.*y5 - 336.*x5.*y + 360.*x.*y7 + 504.*x7.*y);
dy=dy+c(53).*(840.*x4.*y2 - 840.*x2.*y4 + 1260.*x2.*y6 - 630.*x4.*y4 - 756.*x6.*y2 - 56.*x6 + 63.*x8 + 56.*y6 - 81.*y8);
end
if (54<=N)
z = z + c(54).*(126.*x5.*y4 - 84.*x3.*y6 - 36.*x7.*y2 + 9.*x.*y8 + x9);
dx=dx+c(54).*(630.*x4.*y4 - 252.*x2.*y6 - 252.*x6.*y2 + 9.*x8 + 9.*y8);
dy=dy+c(54).*(504.*x5.*y3 - 504.*x3.*y5 + 72.*x.*y7 - 72.*x7.*y);
end
if (55<=N)
z = z + c(55).*(126.*x4.*y5 - 36.*x2.*y7 - 84.*x6.*y3 + 9.*x8.*y + y9);
dx=dx+c(55).*(504.*x3.*y5 - 504.*x5.*y3 - 72.*x.*y7 + 72.*x7.*y);
dy=dy+c(55).*(630.*x4.*y4 - 252.*x2.*y6 - 252.*x6.*y2 + 9.*x8 + 9.*y8);
end

dxdy = [dx dy]/R;

%% 
%%
% R_00(r) = 1 Z_1 = 1;
% R_11(r) cos(phi) = 1/2 Z_2 = x;
% R_11(r) sin(phi) = 1/2 Z_3 = y;
% R_20(r) = 1/3.*3(1/2) Z_4 = 2.*x2 +2.*y2 -1;
% R_22(r) sin(2.*phi) = 1/6.*6(1/2) Z_5 = 2.*x.*y;
% R_22(r) cos(2.*phi) = 1/6.*6(1/2) Z_6 = x2 -y2;
% R_31(r) sin(phi) = 1/4.*2(1/2) Z_7 = 3.*x2.*y +3.*y3 -2.*y;
% R_31(r) cos(phi) = 1/4.*2(1/2) Z_8 = 3.*x3 +3.*x.*y2 -2.*x;
% R_33(r) sin(3.*phi) = 1/4.*2(1/2) Z_9 = 3.*x2.*y -y3;
% R_33(r) cos(3.*phi) = 1/4.*2(1/2) Z_10 = x3 -3.*x.*y2;
% R_40(r) = 1/5.*5(1/2) Z_11 = 6.*x4 +12.*x2.*y2 +6.*y4 -6.*x2 -6.*y2 +1;
% R_42(r) cos(2.*phi) = 1/10.*10(1/2) Z_12 = 4.*x4 -4.*y4 -3.*x2 +3.*y2;
% R_42(r) sin(2.*phi) = 1/10.*10(1/2) Z_13 = 8.*x3.*y +8.*x.*y3 -6.*x.*y;
% R_44(r) cos(4.*phi) = 1/10.*10(1/2) Z_14 = x4 -6.*x2.*y2 +y4;
% R_44(r) sin(4.*phi) = 1/10.*10(1/2) Z_15 = 4.*x3.*y -4.*x.*y3;
% R_51(r) cos(phi) = 1/6.*3(1/2) Z_16 = 10.*x5 +20.*x3.*y2 +10.*x.*y4 -12.*x3 -12.*x.*y2 +3.*x;
% R_51(r) sin(phi) = 1/6.*3(1/2) Z_17 = 10.*x4.*y +20.*x2.*y3 +10.*y5 -12.*x2.*y -12.*y3 +3.*y;
% R_53(r) cos(3.*phi) = 1/6.*3(1/2) Z_18 = 5.*x5 -10.*x3.*y2 -15.*x.*y4 -4.*x3 +12.*x.*y2;
% R_53(r) sin(3.*phi) = 1/6.*3(1/2) Z_19 = 15.*x4.*y +10.*x2.*y3 -5.*y5 -12.*x2.*y +4.*y3;
% R_55(r) cos(5.*phi) = 1/6.*3(1/2) Z_20 = x5 -10.*x3.*y2 +5.*x.*y4;
% R_55(r) sin(5.*phi) = 1/6.*3(1/2) Z_21 = 5.*x4.*y -10.*x2.*y3 +y5;
% R_60(r) = 1/7.*7(1/2) Z_22 = 20.*x6 +60.*x4.*y2 +60.*x2.*y4 +20.*y6 -30.*x4 -60.*x2.*y2 -30.*y4 +12.*x2 +12.*y2 -1;
% R_62(r) sin(2.*phi) = 1/14.*14(1/2) Z_23 = 30.*x5.*y +60.*x3.*y3 +30.*x.*y5 -40.*x3.*y -40.*x.*y3 +12.*x.*y;
% R_62(r) cos(2.*phi) = 1/14.*14(1/2) Z_24 = 15.*x6 +15.*x4.*y2 -15.*x2.*y4 -15.*y6 -20.*x4 +20.*y4 +6.*x2 -6.*y2;
% R_64(r) sin(4.*phi) = 1/14.*14(1/2) Z_25 = 24.*x5.*y -24.*x.*y5 -20.*x3.*y +20.*x.*y3;
% R_64(r) cos(4.*phi) = 1/14.*14(1/2) Z_26 = 6.*x6 -30.*x4.*y2 -30.*x2.*y4 +6.*y6 -5.*x4 +30.*x2.*y2 -5.*y4;
% R_66(r) sin(6.*phi) = 1/14.*14(1/2) Z_27 = 6.*x5.*y -20.*x3.*y3 +6.*x.*y5;
% R_66(r) cos(6.*phi) = 1/14.*14(1/2) Z_28 = x6 -15.*x4.*y2 +15.*x2.*y4 -y6;
% R_71(r) sin(phi) = 1/4 Z_29 = 35.*x6.*y +105.*x4.*y3 +105.*x2.*y5 +35.*y7 -60.*x4.*y -120.*x2.*y3 -60.*y5 +30.*x2.*y +30.*y3 -4.*y;
% R_71(r) cos(phi) = 1/4 Z_30 = 35.*x7 +105.*x5.*y2 +105.*x3.*y4 +35.*x.*y6 -60.*x5 -120.*x3.*y2 -60.*x.*y4 +30.*x3 +30.*x.*y2 -4.*x;
% R_73(r) sin(3.*phi) = 1/4 Z_31 = 63.*x6.*y +105.*x4.*y3 +21.*x2.*y5 -21.*y7 -90.*x4.*y -60.*x2.*y3 +30.*y5 +30.*x2.*y -10.*y3;
% R_73(r) cos(3.*phi) = 1/4 Z_32 = 21.*x7 -21.*x5.*y2 -105.*x3.*y4 -63.*x.*y6 -30.*x5 +60.*x3.*y2 +90.*x.*y4 +10.*x3 -30.*x.*y2;
% R_75(r) sin(5.*phi) = 1/4 Z_33 = 35.*x6.*y -35.*x4.*y3 -63.*x2.*y5 +7.*y7 -30.*x4.*y +60.*x2.*y3 -6.*y5;
% R_75(r) cos(5.*phi) = 1/4 Z_34 = 7.*x7 -63.*x5.*y2 -35.*x3.*y4 +35.*x.*y6 -6.*x5 +60.*x3.*y2 -30.*x.*y4;
% R_77(r) sin(7.*phi) = 1/4 Z_35 = 7.*x6.*y -35.*x4.*y3 +21.*x2.*y5 -y7;
% R_77(r) cos(7.*phi) = 1/4 Z_36 = x7 -21.*x5.*y2 +35.*x3.*y4 -7.*x.*y6;
% R_80(r) = 1/3 Z_37 = 70.*x8 +280.*x6.*y2 +420.*x4.*y4 +280.*x2.*y6 +70.*y8 -140.*x6 -420.*x4.*y2 -420.*x2.*y4 -140.*y6 +90.*x4 +180.*x2.*y2 +90.*y4 -20.*x2 -20.*y2 +1;
% R_82(r) cos(2.*phi) = 1/6.*2(1/2) Z_38 = 56.*x8 +112.*x6.*y2 -112.*x2.*y6 -56.*y8 -105.*x6 -105.*x4.*y2 +105.*x2.*y4 +105.*y6 +60.*x4 -60.*y4 -10.*x2 +10.*y2;
% R_82(r) sin(2.*phi) = 1/6.*2(1/2) Z_39 = 112.*x7.*y +336.*x5.*y3 +336.*x3.*y5 +112.*x.*y7 -210.*x5.*y -420.*x3.*y3 -210.*x.*y5 +120.*x3.*y +120.*x.*y3 -20.*x.*y;
% R_84(r) cos(4.*phi) = 1/6.*2(1/2) Z_40 = 28.*x8 -112.*x6.*y2 -280.*x4.*y4 -112.*x2.*y6 +28.*y8 -42.*x6 +210.*x4.*y2 +210.*x2.*y4 -42.*y6 +15.*x4 -90.*x2.*y2 +15.*y4;
% R_84(r) sin(4.*phi) = 1/6.*2(1/2) Z_41 = 112.*x7.*y +112.*x5.*y3 -112.*x3.*y5 -112.*x.*y7 -168.*x5.*y +168.*x.*y5 +60.*x3.*y -60.*x.*y3;
% R_86(r) cos(6.*phi) = 1/6.*2(1/2) Z_42 = 8.*x8 -112.*x6.*y2 +112.*x2.*y6 -8.*y8 -7.*x6 +105.*x4.*y2 -105.*x2.*y4 +7.*y6;
% R_86(r) sin(6.*phi) = 1/6.*2(1/2) Z_43 = 48.*x7.*y -112.*x5.*y3 -112.*x3.*y5 +48.*x.*y7 -42.*x5.*y +140.*x3.*y3 -42.*x.*y5;
% R_88(r) cos(8.*phi) = 1/6.*2(1/2) Z_44 = x8 -28.*x6.*y2 +70.*x4.*y4 -28.*x2.*y6 +y8;
% R_88(r) sin(8.*phi) = 1/6.*2(1/2) Z_45 = 8.*x7.*y -56.*x5.*y3 +56.*x3.*y5 -8.*x.*y7;
% R_91(r) cos(phi) = 1/10.*5(1/2) Z_46 = 126.*x9 +504.*x7.*y2 +756.*x5.*y4 +504.*x3.*y6 +126.*x.*y8 -280.*x7 -840.*x5.*y2 -840.*x3.*y4 -280.*x.*y6 +210.*x5 +420.*x3.*y2 +210.*x.*y4 -60.*x3 -60.*x.*y2 +5.*x;
% R_91(r) sin(phi) = 1/10.*5(1/2) Z_47 = 126.*x8.*y +504.*x6.*y3 +756.*x4.*y5 +504.*x2.*y7 +126.*y9 -280.*x6.*y -840.*x4.*y3 -840.*x2.*y5 -280.*y7 +210.*x4.*y +420.*x2.*y3 +210.*y5 -60.*x2.*y -60.*y3 +5.*y;
% R_93(r) cos(3.*phi) = 1/10.*5(1/2) Z_48 = 84.*x9 -504.*x5.*y4 -672.*x3.*y6 -252.*x.*y8 -168.*x7 +168.*x5.*y2 +840.*x3.*y4 +504.*x.*y6 +105.*x5 -210.*x3.*y2 -315.*x.*y4 -20.*x3 +60.*x.*y2;
% R_93(r) sin(3.*phi) = 1/10.*5(1/2) Z_49 = 252.*x8.*y +672.*x6.*y3 +504.*x4.*y5 -84.*y9 -504.*x6.*y -840.*x4.*y3 -168.*x2.*y5 +168.*y7 +315.*x4.*y +210.*x2.*y3 -105.*y5 -60.*x2.*y +20.*y3;
% R_95(r) cos(5.*phi) = 1/10.*5(1/2) Z_50 = 36.*x9 -288.*x7.*y2 -504.*x5.*y4 +180.*x.*y8 -56.*x7 +504.*x5.*y2 +280.*x3.*y4 -280.*x.*y6 +21.*x5 -210.*x3.*y2 +105.*x.*y4;
% R_95(r) sin(5.*phi) = 1/10.*5(1/2) Z_51 = 180.*x8.*y -504.*x4.*y5 -288.*x2.*y7 +36.*y9 -280.*x6.*y +280.*x4.*y3 +504.*x2.*y5 -56.*y7 +105.*x4.*y -210.*x2.*y3 +21.*y5;
% R_97(r) cos(7.*phi) = 1/10.*5(1/2) Z_52 = 9.*x9 -180.*x7.*y2 +126.*x5.*y4 +252.*x3.*y6 -63.*x.*y8 -8.*x7 +168.*x5.*y2 -280.*x3.*y4 +56.*x.*y6;
% R_97(r) sin(7.*phi) = 1/10.*5(1/2) Z_53 = 63.*x8.*y -252.*x6.*y3 -126.*x4.*y5 +180.*x2.*y7 -9.*y9 -56.*x6.*y +280.*x4.*y3 -168.*x2.*y5 +8.*y7;
% R_99(r) cos(9.*phi) = 1/10.*5(1/2) Z_54 = x9 -36.*x7.*y2 +126.*x5.*y4 -84.*x3.*y6 +9.*x.*y8;
% R_99(r) sin(9.*phi) = 1/10.*5(1/2) Z_55 = 9.*x8.*y -84.*x6.*y3 +126.*x4.*y5 -36.*x2.*y7 +y9;